Идентификация - процесс, в котором субъект сообщает системе, кем он является (передаём уникальный идентификатор).

Аутентификация - процесс проверки подлинности субъекта (пароль, смс, код, биометрия).

Авторизация - процесс определения прав субъекта внутри системы (проверка наличия доступа, предоставление прав доступа к определённым ресурсам системы).

Аутентификация отвечает на вопрос «кто вы?», а авторизация - на вопрос «что вы можете делать?».
### Аутентификация на основе сессий(куки)

Протокол HTTP не отслеживает состояние, а лишь передаёт запрос. Поэтому при каждом запросе сервер не знает, что этот запрос отправил тот же человек, что и предыдущий запрос.
Аутентификация на основе сессий/куки делает соединение **stateful** (отслеживание состояний):
   - [[сервер]] хранит активные сессии (в памяти или базе данных);
   - [[клиент]] хранит идентификатор сессии в куке.
##### Процедура:
1. пользователь вводит логин и пароль, клиент отправляет запрос на сервер;
2. сервер проверяет данные (аутентификация), создаёт уникальный токен (**сессию**), сохраняет его (в памяти или в [[база данных]]) и отправляет на клиент;
3. клиент сохраняет токен в куках и отправляет его при каждом запросе;
4. при каждом запросе сервер аутентифицирует пользователя по токену и возвращает данные клиенту;
5. при выходе пользователя токен удаляется, последующие запросы становятся неаутентифицированными.
![[sessions.png]]
##### Недостатки:
- сервер создаёт запись для каждой сессии - нагрузка на систему при большом количестве пользователей;
- сессии в памяти сложно масштабировать - при репликации сервера сессии нужно синхронизировать между всеми инстансами.
### Аутентификация на основе токенов

При аутентификации на основе токенов используются [[JWT]] (**Json Web Tokens**). Состояния не отслеживаются. Сервер не хранит информацию о пользователе и не ведёт сессии и даже хранит JWT, использованные для клиентов.
##### Процедура:
1. пользователь вводит логин и пароль;
2. сервер проверяет их и возвращает токен ([[JWT]]), содержащий метаданные (user_id, разрешения и т.д.);
3. токен хранится на клиенте (локальное хранилище, хранилище сессий или кук);
4. при последующих запросах токен отправляется в заголовке авторизации (_Bearer {JWT}_) или в теле запроса/параметре запроса;
5. сервер расшифровывает [[JWT]] и, если он верный, обрабатывает запрос;
6. при выходе пользователя токен уничтожается на клиенте, с сервером взаимодействовать не нужно.
![[tokens.png]]
##### Преимущества:
- **отсутствие состояния:** сервер не хранит сессии или токены, проще масштабировать;
- каждый токен самодостаточен, содержит все необходимые для проверки данные, а также передаёт затребованную пользовательскую информацию;
- хранение метаданных любого типа прямо в токене (JSON);
- легче реализовать на мобильных платформах (iOS, Android) и в IoT, где куки использовать неудобно.
### Беспарольная аутентификация

Беспарольная аутентификация - это способ конфигурирования процедуры входа и аутентификации пользователей без ввода паролей, когда пользователь вводит только почту, а приложение отправляет одноразовую ссылку, по которой пользователь автоматически входит.
##### Варианты реализации:
- одноразовые ссылки на почту;
- одноразовые коды/пароли через SMS или почту (для SMS нужен SMS-сервис, например Twilio);
- биометрия (Touch ID на устройствах Apple).

Можно совмещать с традиционной авторизацией, чтобы дать выбор пользователю.

**Риски:** Доступ к почтовому аккаунту = доступ ко всем сервисам с беспарольной аутентификацией. Безопасность почтовых аккаунтов пользователей не контролируется разработчиком.
### Единая точка входа (Single Sign-On, SSO)

Пользователь входит один раз и получает доступ ко всем связанным системам без повторного логина. Используется центральный сервис для оркестрации единого входа между несколькими клиентами (например, сервисы Google).
##### Процедура:
1. пользователь входит в один из сервисов;
2. пользователь получает сгенерированную куку у identity provider (IDP) (например, Google Accounts);
3. при переходе в другой сервис (service provider, SP) пользователь перенаправляется в IDP;
4. IDP видит, что пользователю уже присвоена кука, и перенаправляет пользователя в SP без повторного ввода пароля.
##### Сущности в SSO:
- пользователь - проходит аутентификацию (владелец ресурса);
- Identity Provider (IDP) - проверяет пользователя;
- Service Provider (SP) - доверяет IDP и предоставляет сервис пользователю.
### Аутентификация через социальные сети (Social Sign-In / Social Login)

Разновидность SSO, где пользователи используют аккаунты соцсетей для входа в приложение. Пользователю не нужно регистрироваться отдельно, не нужно помнить пароли.
##### Процедура: (через OAuth)
1. приложение (клиент) перенаправляет пользователя на соцсеть (сервер ресурсов) для аутентификации;    
2. пользователь подтверждает разрешение на доступ к своему профилю;
3. соцсеть возвращает приложение с токеном доступа;
4. в дальнейшем приложение использует токен для получения информации о пользователе из соцсети.
### Двухфакторная аутентификация (2FA)

Двухфакторная аутентификация (2FA) улучшает безопасность доступа за счёт использования двух методов (также называемых факторами) проверки личности пользователя. Это разновидность многофакторной аутентификации. Cначала нужно ввести логин и пароль, а затем одноразовый пароль (код проверки), отправляемый по SMS.

Вместо одноразового пароля в качестве второго фактора могут использоваться отпечатки пальцев или снимок сетчатки.

При двухфакторной аутентификации пользователь должен предоставить два из трёх:
- **то, что вы знаете:** пароль или PIN;
- **то, что у вас есть:** физическое устройство (смартфон) или приложение, генерирующее одноразовые пароли;
- **часть вас:** биологически уникальное свойство вроде отпечатков пальцев, голоса или снимка сетчатки.