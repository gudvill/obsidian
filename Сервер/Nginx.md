**Nginx** - программное обеспечение с открытым исходным кодом для создания высокопроизводительного веб-сервера. Может работать как HTTP-сервер, обратный прокси-сервер с поддержкой кэширования и балансировки нагрузки, TCP/UDP-прокси, а также почтовый прокси-сервер.

Сайт - это набор файлов, которые хранятся в интернете, на компьютере и пересылаются пользователю, когда он открывает этот сайт. При открытии сайта браузер отправляет [[HTTP]]-запрос (текстовый запрос специального формата, с помощью которого сервер понимает, что нужно пользователю) веб-серверу, а сервер возвращает ответ - HTML-страницу, файлы стилей, скрипты или другие ресурсы.
#### Nginx используется:
- для приёма и обработки большого количества одновременных клиентских запросов;
- для обслуживания сайтов с большим объёмом статического контента;
- в качестве обратного прокси-сервера и балансировщика нагрузки;
- для SSL/TLS-терминации, обеспечивая шифрование и дешифрование данных между клиентами и серверами, снимая нагрузку с backend-серверов;
- как почтовый прокси-сервер.
#### Особенности Nginx:
- высокая производительность при работе со статическим контентом, который не нужно постоянно обновлять (Nginx кэширует данные у себя);
- поддержка кэширования;
- гибкая и модульная конфигурация;
- низкое потребление памяти за счёт асинхронной архитектуры и пулов памяти.
#### Как работает Nginx
Nginx - это веб-сервер и прокси-сервер с асинхронной неблокирующей архитектурой, позволяющей эффективно обрабатывать большое количество одновременных соединений.

Вместо создания отдельного процесса для каждого клиента Nginx использует небольшое число рабочих процессов. Каждый процесс может обслуживать тысячи сетевых соединений за счёт неблокирующей обработки ввода-вывода: один процесс поэтапно обрабатывает множество соединений, не ожидая завершения каждого из них..

Nginx может работать в двух основных режимах:
- **Веб-сервер** - принимает HTTP-запросы, обрабатывает их и отдаёт статический или динамический контент напрямую клиенту;
- **Прокси-сервер** - принимает запросы от клиента, перенаправляет их backend-сервисам, получает ответ и возвращает его клиенту. В этом режиме Nginx выполняет маршрутизацию, балансировку нагрузки и оптимизирует взаимодействие между клиентом и серверной логикой.
#### Пример файла Nginx
```nginx
# пользователь, от имени которого работает Nginx
user www-data;
# кол-во рабочих процессов (обычно = числу ядер CPU)
worker_processes auto;
# макс. кол-во соединений на один рабочий процесс
events {
    worker_connections 1024;
}
http {
    # подключение MIME-типов
    include       mime.types;
    default_type  application/octet-stream;
    # логирование
    access_log /var/log/nginx/access.log;
    error_log  /var/log/nginx/error.log;
    # оптимизация передачи данных
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    # таймауты
    keepalive_timeout 65;
	# сжатие ответов
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    # виртуальный сервер
    server {
        listen 80;
        server_name example.com www.example.com;
        root /var/www/example;
        index index.html index.htm;
        # обработка запросов к сайту
        location / {
            try_files $uri $uri/ =404;
        }
        # проксирование запросов к backend-приложению
        location /api/ {
            proxy_pass http://127.0.0.1:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
        # кэширование статических файлов
        location ~* \.(jpg|jpeg|png|css|js|ico)$ {
            expires 30d;
            access_log off;
        }
    }
}
```
###### `server`
Этот блок описывает виртуальный сервер Nginx - набор правил, по которым Nginx принимает HTTP-запросы на 80-м порту для доменов `example.com` и `www.example.com`, определяет корневую директорию сайта, отдаёт статические файлы напрямую, перенаправляет запросы к `/api/` на backend-приложение и задаёт кэширование для статических ресурсов.

**Основные директивы**
- `listen 80;` - указывает, что сервер принимает HTTP-запросы на 80-м порту;
- `server_name example.com www.example.com;` - задаёт домены, для которых применяется этот виртуальный сервер;
- **`root /var/www/example;`** - определяет корневую директорию сайта, из которой отдаются файлы;
- **`index index.html index.htm;`** - указывает файлы, которые отдаются по умолчанию при обращении к каталогу.

**Обработка запросов**
- **`location /`** - правило обработки всех запросов к корню сайта;
- **`try_files $uri $uri/ =404;`** - пытается найти запрошенный файл или каталог, иначе возвращает ошибку 404.

**Проксирование**
- **`location /api/`** - правило для запросов, начинающихся с `/api/`;
- **`proxy_pass http://127.0.0.1:3000;`** - перенаправляет запросы к backend-приложению на локальном порту 3000;
- **`proxy_set_header Host $host;`** - передаёт backend-приложению оригинальный домен запроса;
- **`proxy_set_header X-Real-IP $remote_addr;`** - передаёт реальный IP клиента;
- **`proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;`** - добавляет цепочку IP-адресов прокси.

**Кэширование статики**
- **`location ~* \.(jpg|jpeg|png|css|js|ico)$`** - правило для статических файлов по расширению (регулярное выражение, без учёта регистра);
- **`expires 30d;`** - задаёт кэширование файлов в браузере на 30 дней;
- **`access_log off;`** - отключает логирование запросов к статическим файлам.



