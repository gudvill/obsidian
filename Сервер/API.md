**API** (application programming interface - программный интерфейс приложения) - это ПО, которое действует как посредник между приложениями, описывает набор способов и правил, по которым приложения взаимодействуют друг с другом (с помощью HTTP-запросов). Это инструмент, который делает данные веб-сайта удобными для использования компьютером.

Все эти взаимодействия происходят с помощью функций, классов, методов, структур, а иногда констант одной программы, к которой обращаются другие. Это основной принцип работы API.
![[api.png]]
API - это контракт, который предоставляет программа. «Ко мне можно обращаться так и так, я обязуюсь делать то и это». Включает в себя:  
- саму операцию, которую мы можем выполнить;
- данные, которые поступают на вход;
- данные, которые оказываются на выходе (контент данных или сообщение об ошибке).

API - это набор функций. Приложение общается с сервером через API.

Runscope - веб-приложение, используемое для мониторинга, отладки и тестирования производительности веб-сервисов API.

Документация API - технический контент, который подробно описывает API, включает всё, что нужно знать об API (от эффективной интеграции до обновлений жизненного цикла API, проектирования и покрытия тестирования). 
### ==API - это интерфейс==

В программировании контракт - это и есть интерфейс. **Интерфейс** - это граница между двумя функциональными системами, на которой происходит их взаимодействие и обмен информацией. При этом процессы внутри каждой из систем скрыты друг от друга.

C помощью вызовов API можно выполнить определённые функции программы, не зная, как она работает. Чтобы использовать этот интерфейс, важно понимать:  
- что подать на вход;
- что получается на выходе;
- какие исключения нужно обработать.

Пользователи работают с GUI - graphical user interface.
Программы работают с API - application programming interface. Им не нужна графика, только контракт.
### ==Вызов API==

Напрямую:  
1. система вызывает функции внутри себя (разные части программы как-то общаются между собой. Они делают это на программном уровне, то есть на уровне API);
2. система вызывает метод другой системы (тестировщики проверяют интеграцию своей системы с чужой);
3. человек вызывает метод (вместо использования графического интерфейса);
4. авто-тесты дергают методы. Пирамида автоматизации:  
	- GUI-тесты - честный тест, «как это делал бы пользователь» (через браузер);
	- API-тесты - опускаемся на уровень ниже, выкидывая лишнее (просто подаем данные на вход и проверяем данные на выходе, без браузера);
	- Unit-тесты - тесты на отдельную функцию.
Косвенно:  
5. пользователь работает с GUI (под графическим пользовательским интерфейсом находится API, то есть gui вызывает функции api).
### ==Интеграция==

**Интеграция** - это процесс, в рамках которого несколько приложений соединяются между собой с помощью API и обмениваются данными. 

Когда две системы соединяются через API, говорят, что они "интегрированы". В интеграции есть две стороны:
- сервер - фактически предоставляет API (API - другая программа, работающая на сервере);
- клиент - отдельная программа, которая знает, какие данные доступны через API.

Одна система общается с другой по какому-то протоколу передачи данных. Это называется Remote API, то есть общение по сети, по некоему **протоколу** (HTTP, JMS и т.д.). В противовес ему есть еще Local API (Shared memory API) - это то API, по которому программа общается сама с собой или общается с другой программой внутри одной виртуальной памяти.
### ==Виды API==

Web API - общее название для всех API, которые используют для взаимодействия между веб-сервисами через интернет. С их помощью приложения обмениваются данными и выполняют действия по стандартному и надёжному каналу связи - **протоколу** **HTTP(S)** через порт 80.
#### REST API

REST API (Representational State Transfer) - это архитектурный стиль взаимодействия между клиентом и сервером через HTTP-запросы, используется в веб-разработке для интеграции сервисов и приложений. Он определяет принципы построения API, обеспечивая масштабируемость, стандартизированный и эффективный обмен данными между различными системами.  
  
Сервер предоставляет ресурсы в виде данных, а клиент получает к ним доступ с помощью стандартных HTTP-запросов. Каждый ресурс в REST API имеет уникальный идентификатор (URI) и управляется с помощью методов HTTP. 
##### Ключевые компоненты REST
1. **ресурс** - это любая сущность, к которой можно получить доступ через API. Каждый ресурс имеет уникальный идентификатор (URI). Это могут быть пользователи, заказы, товары или другие объекты системы (ресурсы синонимичны классам в ЯП);
2. **методы HTTP**:
	- GET - получение данных о ресурсе;
	- POST - создание нового ресурса;
	- DELETE - удаление ресурса;
	- PUT - обновление существующего ресурса;
	- PATCH - частичное обновление ресурса;
	- HEAD - запрашивает ресурс так же, как и метод GET, но без тела ответа;
	- CONNECT - устанавливает "туннель" к серверу, определённому по ресурсу;
	- OPTIONS - используется для описания параметров соединения с ресурсом;
	- TRACE - выполняет вызов возвращаемого тестового сообщения с ресурса.
3. **HTTP-запросы и ответы**, через которые происходит обмен данными между клиентом и сервером, используя формат [[JSON]]. 
	**запрос** включает:  
    - метод HTTP;  
    - URI запрашиваемого ресурса (URL);  
    - заголовки;  
    - тело запроса (обычно JSON).
    **ответ** включает:  
    - код состояния;  
    - заголовки;  
    - тело ответа (обычно JSON).
4. **заголовки HTTP** используются для передачи дополнительной информации, такой как тип контента (Content-Type), параметры аутентификации (Authorization), кодировки и кеширования (Cache-Control);
5. **коды ответа (состояния) HTTP**:
	- 1xx - готовность сервера;
	- 2xx - успешная обработка запроса;
	- 3xx - перенаправление;
	- 4xx - ошибка на стороне клиента;
	- 5xx - ошибка на стороне сервера.
##### Принципы REST
1. **клиент-серверная архитектура**: код и ресурсы веб-страницы хранятся на серверах, а браузер выступает в роли клиента, который запрашивает с сервера нужные данные;
2. **отсутствие состояния**: сервер не хранит данные о предыдущих взаимодействиях с клиентом (сессии), каждый запрос от клиента к серверу должен быть самодостаточным (независим от предыдущих запросов);
3. **кэшируемость**: клиент может сохранять ответы API (если указано, что они могут быть кэшированы клиентом) для повторного использования без выполнения запроса;
4. **единообразие интерфейса**: используются стандартные методы HTTP (GET, POST, PUT, DELETE), данные передаются в форматах JSON или XML, ресурсы имеют чёткую структуру и единообразные URL-адреса;
5. **система уровней**: архитектура REST API состоит из серверов, прокси, шлюзов, балансировщиков нагрузки и другого;
6. **код по требованию (опционально)**: сервер может отправлять код, который будет выполняться уже на стороне клиента (код JS-скриптов или других интерактивных элементов интерфейса).
##### Как работает REST
1. инициация (отправка) запроса клиентом (веб-приложение, мобильное приложение или др.);
2. сервер получает запрос, идентифицирует запрашиваемый ресурс и выполняет соответствующее действие;
3. формирование ответа клиенту;
4. клиент анализирует ответ и отображает данные пользователю или выполняет дальнейшие операции;
5. если запрос содержит некорректные данные или сервер не может обработать его, возвращается код ошибки. Клиент должен обработать ошибку и предпринять соответствующие действия.
##### Безопасность в REST API
1. [[аутентификация]] (проверяет, кто делает запрос) и [авторизация](Аутентификация) (определяет, какие действия разрешены пользователю).  
    - Basic Authentication - передача логина и пароля в заголовке запроса (небезопасно без HTTPS);
    - OAuth 2.0 - стандарт для безопасной авторизации через токены доступа;
    - [[JWT]] - токены, которые позволяют передавать данные о пользователе между клиентом и сервером.
2. HTTPS (TLS/SSL) и шифрование - защита передаваемых данных от перехвата и атак типа «человек посередине» (MITM);
3. ограничение запросов - защита API от перегрузок и атак типа DDoS;
4. валидация данных (проверка входных данных) - предотвращение SQL-инъекций и XSS-атак (Content-Type и CORS защищает API от несанкционированных межсайтовых запросов);
5. логирование и мониторинг - для выявление атак и анализа работы API;
6. ограничение доступа к данным - ролевые модели доступа (RBAC).
##### Тестирование REST API
1. **функциональное тестирование** (модульное) - корректность HTTP-методов, структура и содержание ответов (JSON, XML), соответствие кодов состояния;
2. **интеграционное тестирование** - оценивается взаимодействие API с другими сервисами, базами данных, платёжными шлюзами и внешними системами;
3. **нагрузочное тестирование** (при высокой нагрузке) - проверка способности API обрабатывать большое количество запросов одновременно, устойчивости к перегрузкам, поведения при ограничении частоты запросов;
4. **тестирование на безопасность** - защита от атак (SQL-инъекции, XSS-атаки, атаки перебором (Brute Force) на аутентификацию);
5. **автоматизация тестирования:**
    - Postman - ручное и автоматизированное тестирование API;
    - JUnit (Java), pytest (Python) - тестирование API в коде;
    - Swagger (OpenAPI) - проверка соответствия спецификации.
##### Минусы REST API
- использует текстовые форматы (JSON), что увеличивает объём передаваемых данных в сравнении с бинарными форматами;
- нет строгой спецификации, API реализуется на основе требований конкретного проекта;
- необходимо самостоятельно внедрять средства авторизации и аутентификации, встроенных механизмов защиты нет;
- построен на синхронном протоколе HTTP, который работает в формате «запрос-ответ», из-за этого нет поддержки долгоживущих соединений (веб-сокетов).
#### SOAP

SOAP - строгий протокол обмена сообщениями по сети. Для форматирования сообщений используется язык разметки XML, а правила описания, обработки и передачи сообщений жёстко стандартизированы. Одна из главных отличительных черт SOAP - высокий уровень безопасности, который обеспечивается механизмами шифрования, аутентификации сообщений и управления транзакциями.
##### Плюсы SOAP API
- **стандартизация** - стандартизированный протокол с чёткими правилами для обмена сообщениями, что позволяет всегда получать предсказуемый результат;
- **безопасность** - поддерживаются методы шифрования и управления транзакциями, а сообщения можно подписывать цифровой подписью, что полезно для корпоративных приложений;
- **гибкость** - работает поверх различных протоколов передачи данных, включая HTTP, TCP и SMTP, в отличие от REST API (только HTTP).
##### Минусы SOAP API
- **сложность** - реализация и поддержка SOAP занимает больше времени, чем REST;
- **низкая производительность** - ответы SOAP объёмные, что снижает скорость передачи данных;
- **не поддерживает JSON** - работает с форматом XML, а современные веб-приложения используют JSON.
#### GraphQL

GraphQL - это язык запросов для API. Он хорош тем, что позволяет клиентам запрашивать только данные, которые им действительно нужны. Кроме того, с помощью одного запроса GraphQL можно получить данные, которые в REST требовали бы двух или даже трёх запросов подряд. Такая работа API возможна благодаря строгой типизации структуры запросов.
##### Плюсы GraphQL
- **гибкость** - клиенты могут запрашивать только нужные данные, что позволяет избегать передачи лишней информации;
- **агрегация данных** - с помощью одного запроса можно получить данные сразу из нескольких источников;
- **эффективность** - по сети не передаются лишние данные, что снижает нагрузку на сервер и экономит ресурсы сети.
##### Минусы GraphQL
- **сложность настройки** - внедрение и настройка GraphQL занимает больше времени в сравнении с REST;
- **безопасность** - сложные составные запросы остаются уязвимыми для хакерских атак, требуется дополнительная защита;
- **экосистема** - для GraphQL доступно меньше инструментов и библиотек, чем для REST.
#### RPC (gRPC, tRPC)

RPC - это протокол, который позволяет программе вызывать функции, находящиеся на удалённом сервере, как если бы они выполнялись локально на клиенте. RPC API отправляет на сервер запрос с указанием метода и необходимыми параметрами, а в ответ получает результат выполнения метода. Существуют различные реализации RPC - gRPC от Google и tRPC, построенный на языке TypeScript.
##### Плюсы RPC
- **прост в использовании** - удалённые функции вызываются так же просто, как локальные, что значительно сокращает кодовую базу;
- **высокая производительность** - некоторые реализации RPC API используют бинарные форматы передачи данных и протокол HTTP/2, что ускоряет взаимодействие с удалённым сервером.
##### Минусы RPC
- **меньшая совместимость** - освоить RPC сложнее, чем другие виды API, также надо освоить язык описания интерфейсов (IDL, interface definition language);
- **ограниченная гибкость** - RPC не просто запрашивает ресурсы с удалённого сервера, а просит выполнить определённую функцию и вернуть результат. Такой тип взаимодействия сложнее использовать в современных веб-приложениях.

