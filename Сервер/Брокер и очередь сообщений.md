**Брокер и очередь сообщений**  - ключевые компоненты современной архитектуры приложений. Они обеспечивают асинхронный обмен данными между системами, гарантируя надёжность, маршрутизацию и доставку сообщений.
## Очередь сообщений

**Очередь сообщений** - это структура данных, которая хранит сообщения или пакеты данных до тех пор, пока их не заберёт получатель для последующей обработки.

Это как обычная база данных, но для временного хранения информации, а не для постоянного. Временное хранение помогает не засорять "базу данных" и делать работу этого компонента для передачи данных между частями системы быстрее.
#### Очереди нужны:
1. когда система состоит из нескольких независимых компонентов (сервисов или микросервисов), которые взаимодействуют друг с другом;
2. когда система должна обрабатывать большой объём данных и выдерживать пики нагрузки;
3. когда важна надёжность и гарантии доставки сообщений;
4. когда требуется обеспечить асинхронное взаимодействие приложений, систем или сервисов. Преимущества асинхронного обмена данными через очереди:
	- гарантия доставки и обработки сообщений (сообщение в очереди остаётся до тех пор, пока не будет доставлено и обработано получателем);
	- отказоустойчивость за счёт асинхронного обмена (даже если один сервис-получатель сообщения недоступен, то сообщение останется в очереди и как только он снова станет доступен, то обработает его);
	- масштабируемость (несколько обработчиков могут забирать уведомления из очереди, чтобы быстрее справляться с большим количеством сообщений).
#### Компоненты очереди:
- **Producer** - приложение или сервис, который создаёт сообщение и ставит его в очередь сообщений. Он может поставить задачу в очередь к отложенной обработке;
- **Message Queue** - очередь сообщений к обработке. Аналог базы данных для временного хранения сообщений;
- **Consumer** - приложение или сервис, которое отвечает за чтение сообщений из очереди для их последующей обработки.
#### Как работают очереди
Алгоритмы: 
- FIFO, первый пришёл - первый ушёл; 
- LIFO, последний пришёл - первый ушёл.
Также есть правила обработки сообщений по приоритету, принцип задержки обработки и другие.

**Пример логики работы:**
1. генерация событий и отправка в очередь;
2. публикация событий в очередь - очередь получает и сохраняет каждое сообщение по отдельности, выступает как временное хранилище (аналог базы данных), пока уведомление не будет обработано и отправлено;
3. обработка событий из очереди.
## Брокер сообщений

**Брокер сообщений** - это программное обеспечение, которое управляет обменом сообщениями между приложениями, сервисами или системами. Для обеспечения надёжного хранения сообщений и гарантированной доставки, брокеры часто используют компонент **очередь сообщений**.

Очередь внутри брокера хранит и упорядочивает сообщения до тех пор, пока потребляющие приложения не смогут их обработать. В ней сообщения обычно хранятся в том порядке, в котором они были переданы от отправителя (Producer), и остаются там до подтверждения их получения получателем (Consumer).

Очередь - это именно место хранения сообщений, как временная база данных внутри брокера. Очередей внутри одного брокера может быть несколько.

Брокеры сообщений могут валидировать, хранить, маршрутизировать и доставлять сообщения в нужные сервисы. Они выполняют роль посредников между различными сервисами, позволяя отправителям отправлять сообщения, не зная где находятся получатели, активны ли они в данный момент и сколько их.

**Функции брокера:**
- управление множеством очередей;
- маршрутизация сообщений;
- поддержка нескольких потребителей;
- подтверждение доставки и повторная доставка сообщений в случае сбоя.
#### Паттерны (шаблоны) обмена данными
1. точка-точка (Point-to-Point Messaging) - используется в очередях сообщений, где существует один отправитель и один получатель. Каждое сообщение в очереди отправляется только одному получателю и может быть обработано только один раз;
2. публикация-подписка (Publish/Subscribe Messaging) - отправитель (Producer) публикует сообщения в определённую тему (topic), а подписчики (Consumers) подписываются на темы, чтобы получать сообщения. Такой механизм используется в Kafka. Все сообщения, опубликованные в теме, доставляются всем приложениям, подписанным на неё. Применяется в случаях, где несколько систем должны получить одну и ту же информацию.
#### Основные решения по брокерам
- Apache Kafka;
- RabbitMQ;
- ActiveMQ;
- Amazon MQ, Amazon SQS;
- Яндекс Message Queue (YMQ) - аналог Amazon;
- и другие.
## Разница между очередью и брокером

**Очередь сообщений** - это структура данных, которая хранит сообщения до тех пор, пока их не заберёт получатель.

**Брокер сообщений** - это программное обеспечение, которое управляет обменом сообщений между приложениями. Он может включать в себя множество очередей сообщений и дополнительно поддерживать топики, маршрутизацию, обработку и механизмы гарантии доставки.

Понятие "очередь сообщений" часто звучит вместе с понятием "брокер сообщений", но она может использоваться независимо от брокера. В таком случае её функциональность будет ограничена, так как это будет просто хранилище данных. Если система становится более сложной и требует масштабируемости, надёжности и гибкости, использование специализированного брокера сообщений (Kafka, RabbitMQ) становится необходимым.